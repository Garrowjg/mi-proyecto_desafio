<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Libros Virtuales</title>
    <link rel="stylesheet" href="/estilos/libros.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

<header>
    <nav>
        <div class="logo">
            <h1>BookLab <span>Biblioteca</span></h1>
        </div>
        <ul class="nav-links">
            <li><a href="/api/logiado">Inicio</a></li>
            <li><a href="/api/libroVirtualesLog">Libros Virtuales</a></li>
            <li><a href="/api/reservaLibro">Reserva de Libros</a></li>
        </ul>
    </nav>
</header>

<div class="search-container">
    <div class="search-box">
        <div class="search-input-container">
            <input type="text" id="searchInput" class="search-input" placeholder="Buscar libros por título, autor, categoría...">
            <button id="clearSearch" class="clear-search" title="Limpiar búsqueda">
                <i class="fas fa-times"></i>
            </button>
            <i class="fas fa-search search-icon"></i>
        </div>
        <button id="searchButton" class="search-button">
            <i class="fas fa-search"></i> Buscar
        </button>
    </div>

    <div class="search-filters">
        <div class="filter-option"><input type="checkbox" id="filterNovelas" checked><label for="filterNovelas">Novelas</label></div>
        <div class="filter-option"><input type="checkbox" id="filterCiencia" checked><label for="filterCiencia">Ciencia</label></div>
        <div class="filter-option"><input type="checkbox" id="filterHistoria" checked><label for="filterHistoria">Historia</label></div>
        <div class="filter-option"><input type="checkbox" id="filterArte" checked><label for="filterArte">Arte</label></div>
        <div class="filter-option"><input type="checkbox" id="filterFantasía" checked><label for="filterFantasía">Fantasía</label></div>
        <div class="filter-option"><input type="checkbox" id="filterFilosofia" checked><label for="filterFilosofia">Filosofía</label></div>
    </div>
</div>

<div id="noResults" class="no-results">
    <i class="fas fa-book-open"></i>
    <p>No se encontraron libros que coincidan con tu búsqueda</p>
    <p>Intenta con términos más generales o verifica los filtros aplicados</p>
</div>

<!-- Secciones de libros -->
<section class="section novelas-section">
    <h2 class="section-title">Novelas</h2>
    <div class="table-container">
        <table class="book-table">
            <thead>
            <tr><th>Título</th><th>Autor</th><th>Descripción</th><th>Categoría</th><th>Acción</th></tr>
            </thead>
            <tbody>
            <tr th:each="libro : ${librosNovela}" class="book-row"
                data-title="${libro.titulo.toLowerCase()}"
                data-author="${libro.autor.toLowerCase()}"
                data-category="Novelas"
                data-desc="${libro.descripcion.toLowerCase()}">
                <td th:text="${libro.titulo}">Título</td>
                <td th:text="${libro.autor}">Autor</td>
                <td th:text="${libro.descripcion}">Descripción</td>
                <td th:text="${libro.categoria}">Categoría</td>
                <td><a th:href="${libro.url}" target="_blank" class="download-link">Leer</a></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="pagination"></div>
</section>

<!-- Repetir secciones para Ciencia, Historia, Arte, Fantasía y Filosofía -->
<section class="section ciencia-section">
    <h2 class="section-title">Ciencia</h2>
    <div class="table-container">
        <table class="book-table">
            <thead>
            <tr><th>Título</th><th>Autor</th><th>Descripción</th><th>Categoría</th><th>Acción</th></tr>
            </thead>
            <tbody>
            <tr th:each="libro : ${librosCiencia}" class="book-row"
                data-title="${libro.titulo.toLowerCase()}"
                data-author="${libro.autor.toLowerCase()}"
                data-category="Ciencia"
                data-desc="${libro.descripcion.toLowerCase()}">
                <td th:text="${libro.titulo}">Título</td>
                <td th:text="${libro.autor}">Autor</td>
                <td th:text="${libro.descripcion}">Descripción</td>
                <td th:text="${libro.categoria}">Categoría</td>
                <td><a th:href="${libro.url}" target="_blank" class="download-link">Leer</a></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="pagination"></div>
</section>

<section class="section historia-section">
    <h2 class="section-title">Historia</h2>
    <div class="table-container">
        <table class="book-table">
            <thead>
            <tr><th>Título</th><th>Autor</th><th>Descripción</th><th>Categoría</th><th>Acción</th></tr>
            </thead>
            <tbody>
            <tr th:each="libro : ${librosHistoria}" class="book-row"
                data-title="${libro.titulo.toLowerCase()}"
                data-author="${libro.autor.toLowerCase()}"
                data-category="Historia"
                data-desc="${libro.descripcion.toLowerCase()}">
                <td th:text="${libro.titulo}">Título</td>
                <td th:text="${libro.autor}">Autor</td>
                <td th:text="${libro.descripcion}">Descripción</td>
                <td th:text="${libro.categoria}">Categoría</td>
                <td><a th:href="${libro.url}" target="_blank" class="download-link">Leer</a></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="pagination"></div>
</section>

<section class="section arte-section">
    <h2 class="section-title">Arte</h2>
    <div class="table-container">
        <table class="book-table">
            <thead>
            <tr><th>Título</th><th>Autor</th><th>Descripción</th><th>Categoría</th><th>Acción</th></tr>
            </thead>
            <tbody>
            <tr th:each="libro : ${librosArte}" class="book-row"
                data-title="${libro.titulo.toLowerCase()}"
                data-author="${libro.autor.toLowerCase()}"
                data-category="Arte"
                data-desc="${libro.descripcion.toLowerCase()}">
                <td th:text="${libro.titulo}">Título</td>
                <td th:text="${libro.autor}">Autor</td>
                <td th:text="${libro.descripcion}">Descripción</td>
                <td th:text="${libro.categoria}">Categoría</td>
                <td><a th:href="${libro.url}" target="_blank" class="download-link">Leer</a></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="pagination"></div>
</section>

<section class="section fantasia-section">
    <h2 class="section-title">Fantasía</h2>
    <div class="table-container">
        <table class="book-table">
            <thead>
            <tr><th>Título</th><th>Autor</th><th>Descripción</th><th>Categoría</th><th>Acción</th></tr>
            </thead>
            <tbody>
            <tr th:each="libro : ${librosFantasía}" class="book-row"
                data-title="${libro.titulo.toLowerCase()}"
                data-author="${libro.autor.toLowerCase()}"
                data-category="Fantasía"
                data-desc="${libro.descripcion.toLowerCase()}">
                <td th:text="${libro.titulo}">Título</td>
                <td th:text="${libro.autor}">Autor</td>
                <td th:text="${libro.descripcion}">Descripción</td>
                <td th:text="${libro.categoria}">Categoría</td>
                <td><a th:href="${libro.url}" target="_blank" class="download-link">Leer</a></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="pagination"></div>
</section>

<section class="section filosofia-section">
    <h2 class="section-title">Filosofía</h2>
    <div class="table-container">
        <table class="book-table">
            <thead>
            <tr><th>Título</th><th>Autor</th><th>Descripción</th><th>Categoría</th><th>Acción</th></tr>
            </thead>
            <tbody>
            <tr th:each="libro : ${librosFilosofia}" class="book-row"
                data-title="${libro.titulo.toLowerCase()}"
                data-author="${libro.autor.toLowerCase()}"
                data-category="Filosofía"
                data-desc="${libro.descripcion.toLowerCase()}">
                <td th:text="${libro.titulo}">Título</td>
                <td th:text="${libro.autor}">Autor</td>
                <td th:text="${libro.descripcion}">Descripción</td>
                <td th:text="${libro.categoria}">Categoría</td>
                <td><a th:href="${libro.url}" target="_blank" class="download-link">Leer</a></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="pagination"></div>
</section>

<footer>
    <p>&copy; 2024 BookLab Biblioteca. Todos los derechos reservados.</p>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const clearSearch = document.getElementById('clearSearch');
        const noResults = document.getElementById('noResults');
        const sections = document.querySelectorAll('.section');

        const categoryFilters = {
            novelas: document.getElementById('filterNovelas'),
            ciencia: document.getElementById('filterCiencia'),
            historia: document.getElementById('filterHistoria'),
            arte: document.getElementById('filterArte'),
            fantasia: document.getElementById('filterFantasía'),
            filosofia: document.getElementById('filterFilosofia')
        };

        function normalizeText(text) {
            return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
        }

        function performSearch() {
            const searchTerm = normalizeText(searchInput.value.trim());
            const selectedCategories = [];
            if (categoryFilters.novelas.checked) selectedCategories.push('Novelas');
            if (categoryFilters.ciencia.checked) selectedCategories.push('Ciencia');
            if (categoryFilters.historia.checked) selectedCategories.push('Historia');
            if (categoryFilters.arte.checked) selectedCategories.push('Arte');
            if (categoryFilters.fantasia.checked) selectedCategories.push('Fantasía');
            if (categoryFilters.filosofia.checked) selectedCategories.push('Filosofía');

            let hasResults = false;
            sections.forEach(section => {
                const category = section.classList[1].split('-')[0];
                const categoryName = category.charAt(0).toUpperCase() + category.slice(1);
                if (selectedCategories.includes(categoryName)) {
                    section.style.display = 'block';
                    const rows = Array.from(section.querySelectorAll('tbody tr'));
                    const filteredRows = rows.filter(row => {
                        const title = row.dataset.title;
                        const author = row.dataset.author;
                        const desc = row.dataset.desc;
                        return searchTerm === '' || title.includes(searchTerm) || author.includes(searchTerm) || desc.includes(searchTerm);
                    });
                    rows.forEach(r => r.style.display = 'none'); // ocultar todos
                    paginateRows(filteredRows, section);
                    if (filteredRows.length > 0) hasResults = true;
                } else {
                    section.style.display = 'none';
                }
            });

            noResults.style.display = hasResults ? 'none' : 'block';
        }

        function paginateRows(rows, section) {
            const paginationDiv = section.querySelector('.pagination');
            const rowsPerPage = 5;
            let currentPage = 1;

            function showPage(page) {
                const start = (page - 1) * rowsPerPage;
                const end = start + rowsPerPage;
                rows.forEach((row, index) => row.style.display = index >= start && index < end ? '' : 'none');
                currentPage = page;
                renderPagination();
            }

            function renderPagination() {
                const totalPages = Math.ceil(rows.length / rowsPerPage);
                paginationDiv.innerHTML = '';
                for (let i = 1; i <= totalPages; i++) {
                    const btn = document.createElement('button');
                    btn.textContent = i;
                    btn.className = i === currentPage ? 'active' : '';
                    btn.addEventListener('click', () => showPage(i));
                    paginationDiv.appendChild(btn);
                }
            }

            showPage(1);
        }

        searchInput.addEventListener('input', function() {
            clearSearch.style.display = this.value.trim() !== '' ? 'block' : 'none';
        });

        clearSearch.addEventListener('click', function() {
            searchInput.value = '';
            clearSearch.style.display = 'none';
            performSearch();
            searchInput.focus();
        });

        searchButton.addEventListener('click', performSearch);
        searchInput.addEventListener('keyup', e => { if (e.key === 'Enter') performSearch(); });
        Object.values(categoryFilters).forEach(filter => filter.addEventListener('change', performSearch));

        performSearch();
    });
</script>

</body>
</html>

